<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Frontend, Mobile, Nodejs, Life Essays, etc."><title>事件委托，事件代理，发布者订阅者模式 | Poeticlife</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">事件委托，事件代理，发布者订阅者模式</h1><a id="logo" href="/.">Poeticlife</a><p class="description">大知闲闲，小知间间；大言炎炎，小言詹詹</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/categories/Tech/"><i class="fa fa-wrench"> 技术</i></a><a href="/categories/Essays/"><i class="fa fa-pencil"> 随笔</i></a><a href="/categories/works/"><i class="fa fa-briefcase"> 作品</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">事件委托，事件代理，发布者订阅者模式</h1><div class="post-meta">Nov 19, 2017<span> | </span><span class="category"><a href="/categories/FrontEnd/">FrontEnd</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>事件委托，事件代理，pub/sub 是工作常用的工作模式，也许只是你没有注意到而已。</p>
<h2 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h2><blockquote>
<p>事件委托：当你通过动态添加元素的时候，如果想要为这个元素绑定事件不能够直接使用诸如<code>onclick</code>方法，只能在其父元素绑定事件，常见于通过 <code>ajax</code> 请求数据。</p>
</blockquote>
<p>简单地写如下示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 通过target来实现来辨别是不是那个元素</div><div class="line">function delegate(dom, eventType, selector, fn) &#123;</div><div class="line">  dom.addEventListener(eventType, function (e) &#123;</div><div class="line">    // var target = e.target;</div><div class="line">    // for (target !== dom; target = e.target;) &#123;</div><div class="line">    //</div><div class="line">    // &#125;</div><div class="line">    var cur = e.target, target = e.target, cur;</div><div class="line">    for (; cur != this; cur = target.parentNode || this) &#123;</div><div class="line">      if (cur.classList.contains(selector)) &#123;</div><div class="line">        fn.call(cur, e);</div><div class="line">        break;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;, false);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>即监听事件的 <code>target</code> 属性来和 <code>selector</code> 进行比对，若是则应用回调函数。</p>
<h2 id="事件代理"><a href="#事件代理" class="headerlink" title="事件代理"></a>事件代理</h2><blockquote>
<p>事件代理： 即为改变函数的上下文。</p>
</blockquote>
<p>使用场景：常见于 DOM 事件的绑定上下文的改变。之前有在用　<code>Backbone</code> 的时候经常会这样用：</p>
<p><code>this.$el.on(&#39;click&#39;, &#39;.item&#39;, $.proxy(this, this.itemClick))</code>　。</p>
<p>用于在　<code>itemClick</code> 绑定的事件中让其上下文为对象。而不是 <code>DOM</code> 元素。翻看 <code>jQuery</code> 源码可见如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">proxy: function( fn, context ) &#123;</div><div class="line">	var tmp, args, proxy;</div><div class="line"></div><div class="line">	if ( typeof context === &quot;string&quot; ) &#123;</div><div class="line">		tmp = fn[ context ];</div><div class="line">		context = fn;</div><div class="line">		fn = tmp;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// Quick check to determine if target is callable, in the spec</div><div class="line">	// this throws a TypeError, but we will just return undefined.</div><div class="line">	if ( !jQuery.isFunction( fn ) ) &#123;</div><div class="line">		return undefined;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// Simulated bind</div><div class="line">	args = slice.call( arguments, 2 );</div><div class="line">	proxy = function() &#123;</div><div class="line">		return fn.apply( context || this, args.concat( slice.call( arguments ) ) );</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	// Set the guid of unique handler to the same of original handler, so it can be removed</div><div class="line">	proxy.guid = fn.guid = fn.guid || jQuery.guid++;</div><div class="line"></div><div class="line">	return proxy;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>还是很容易理解的, 说到改变函数上下文还可以使用 <code>bind</code> 。</p>
<p>具体可查看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="external">这里</a>。</p>
<h2 id="发布者订阅者模式"><a href="#发布者订阅者模式" class="headerlink" title="发布者订阅者模式"></a>发布者订阅者模式</h2><p>发布进行订阅模式是常用的模式比如在 <code>Dom</code> 事件监听的时候就是这种模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$dom.on(&apos;click&apos;, fn);</div><div class="line">$dom.trigger(&apos;click&apos;, args);</div></pre></td></tr></table></figure>
<p>以上 <code>on</code> 即为订阅，<code>trigger</code> 即为发布。这个对于理解 <strong>JavaScript</strong> 框架中的双向监听是有益处的。可以手写一个如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">var pubSub = &#123;</div><div class="line">  subscribers: [],</div><div class="line">  publish: function (eventType) &#123;</div><div class="line">    var slice = Array.prototype.slice;</div><div class="line">    var args = slice.apply(arguments);</div><div class="line"></div><div class="line">    this.subscribers.forEach(function (subscriber) &#123;</div><div class="line">      if (subscriber.eventType === eventType) &#123;</div><div class="line">        subscriber.cb.apply(undefined, args.slice(1))</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;,</div><div class="line">  subscribe: function (eventType, cb) &#123;</div><div class="line">    var isSubscribed = false;</div><div class="line">    for (var i = 0; i &lt; this.subscribers.length; i++) &#123;</div><div class="line">      if (this.subscribers.eventType === eventType) &#123;</div><div class="line">        isSubscribed = true;</div><div class="line">        this.subscribers[i].cb = cb;</div><div class="line">        break;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    if (!isSubscribed) &#123;</div><div class="line">      this.subscribers.push(&#123;</div><div class="line">        eventType: eventType,</div><div class="line">        cb: cb</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 不带参数</div><div class="line">pubSub.subscribe(&apos;event1&apos;, function () &#123; console.log(&apos;订阅者执行&apos;); &#125;);</div><div class="line">pubSub.publish(&apos;event1&apos;);</div><div class="line"></div><div class="line">// 带参数</div><div class="line">pubSub.subscribe(&apos;event2&apos;, function (p1, p2) &#123; console.log(&apos;p1&apos;, p1); &#125;);</div><div class="line">pubSub.publish(&apos;event2&apos;, 2, 3);</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上为自己的对于常用的事件委托，事件代理的理解及发布者订阅进行的理解。</p>
<p>Todolist:</p>
<ul>
<li style="list-style: none"><input type="checkbox"> 那么Nodejs中的事件机制又是如何的呢？</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/11/19/事件委托，事件代理，发布者订阅者模式/" data-id="cja872xj2001k98klmvref0r2" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Design-Pattern/">Design Pattern</a><a href="/tags/Event-Proxy/">Event Proxy</a></div><div class="post-nav"><a href="/2017/11/12/动画收集/" class="next">动画收集</a></div><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2139658"></script></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/">Backend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Essays/">Essays</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/">FrontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/FrontEnd/">FrontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/Source/">Source</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/backend/">backend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/Essays/">Essays</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/express/" style="font-size: 15px;">express</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/affix/" style="font-size: 15px;">affix</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/scrollSpy/" style="font-size: 15px;">scrollSpy</a> <a href="/tags/offset/" style="font-size: 15px;">offset</a> <a href="/tags/position/" style="font-size: 15px;">position</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/Dom/" style="font-size: 15px;">Dom</a> <a href="/tags/CurrentTarget/" style="font-size: 15px;">CurrentTarget</a> <a href="/tags/automate/" style="font-size: 15px;">automate</a> <a href="/tags/Hoisting/" style="font-size: 15px;">Hoisting</a> <a href="/tags/Nodejs/" style="font-size: 15px;">Nodejs</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/FrontEnd/" style="font-size: 15px;">FrontEnd</a> <a href="/tags/Buffer/" style="font-size: 15px;">Buffer</a> <a href="/tags/token/" style="font-size: 15px;">token</a> <a href="/tags/jwt/" style="font-size: 15px;">jwt</a> <a href="/tags/jsonwebtoken/" style="font-size: 15px;">jsonwebtoken</a> <a href="/tags/Mobile/" style="font-size: 15px;">Mobile</a> <a href="/tags/pageYOffset/" style="font-size: 15px;">pageYOffset</a> <a href="/tags/Design-Pattern/" style="font-size: 15px;">Design Pattern</a> <a href="/tags/Event-Proxy/" style="font-size: 15px;">Event Proxy</a> <a href="/tags/animate/" style="font-size: 15px;">animate</a> <a href="/tags/css3/" style="font-size: 15px;">css3</a> <a href="/tags/愉快生活/" style="font-size: 15px;">愉快生活</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/人生感悟/" style="font-size: 15px;">人生感悟</a> <a href="/tags/1像素/" style="font-size: 15px;">1像素</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/19/事件委托，事件代理，发布者订阅者模式/">事件委托，事件代理，发布者订阅者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/12/动画收集/">动画收集</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/28/DOM相关/">DOM相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/21/Nodejs-ES6/">Nodejs ES6</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/ES6碎碎念经/">ES6碎碎念经</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/12/生活的意义/">生活的意义</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/08/window-pageYOffset-window-pageXOffset-clientWidth-clientHeight-etc-一些JavaScript的基础属性/">window.pageYOffset, window.pageXOffset, clientWidth, clientHeight, etc,一些JavaScript的基础属性及实战应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/02/去远方/">去远方</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/13/Nodejs插件express-session详解/">Nodejs插件express-session详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/Bootstrap-affix-源码解读/">Bootstrap affix 源码解读</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.w.com/" title="医方" target="_blank">医方</a><ul></ul><a href="https://github.com/Troland" title="我的Github" target="_blank">我的Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Poeticlife.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>